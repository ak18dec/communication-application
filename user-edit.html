<!DOCTYPE html>
<html lang="en">

<head>
    <title>Communications Application</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@300&display=swap" rel="stylesheet">
</head>

<body>
    <div class="nav-bar">
        <ul>
            <li><a href="group-chat.html">Group Chat</a></li>
            <li><a href="manage-users.html" class="active">Manage Users</a></li>
            <li><a href="manage-documents.html">Manage Documents</a></li>
            <li><a href="index.html">Logout</a></li>
        </ul>
    </div>
    <div class="edit-user-info">
        <form class="edit-user-form" autocomplete="off" method="dialog">
            <div class="edit-user-section">
                <div class="fullname-section">
                    <label for="fullname">Full Name</label>
                    <input type="text" name="fullname" id="fullname">
                </div>

                <div class="email-section">
                    <label for="email">Email</label>
                    <input type="email" name="email" id="email">
                </div>
                
                <div class="button-section">
                    <button type="submit" id="edit-user-save-btn" onclick="updateUser()">Save</button>
                </div>
            </div>
        </form>
    </div>
    <script>
        //Anonymous function load the selected user data
        (function () {
            let selected_user = JSON.parse(localStorage.getItem("user_to_edit"));
            document.getElementById('fullname').value = selected_user.username;
            document.getElementById('email').value = selected_user.email;

        })();
    </script>
    <script>
        function updateUser() {
            let updatedFullName = document.getElementById("fullname").value;
            let updatedEmail = document.getElementById("email").value;
            // let passwordText = document.getElementById("password").value;
            // let confirmPasswordText = document.getElementById("confirm-password").value;

            let userFromLS1 = JSON.parse(localStorage.getItem("users"));

            let old_user_idx = localStorage.getItem('user_to_edit_idx');

            userFromLS1[old_user_idx].username = updatedFullName;
            userFromLS1[old_user_idx].email = updatedEmail;            

            localStorage.setItem("users", JSON.stringify(userFromLS1));

            window.location.href = 'manage-users.html';
        }
    </script>
</body>

</html>